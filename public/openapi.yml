openapi: 3.0.3
info:
  title: Q Medis API
  version: 1.0.0
  description: Static OpenAPI spec
servers:
  - url: http://localhost:8000
paths:
  /api:
    get:
      tags: [System]
      summary: API health (welcome)
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: API is up
                data:
                  service: Q Medis API
                  laravel: "12.x"
                  php: "8.2.x"
                  time: "2025-01-01T12:00:00Z"
  /api/auth/login:
    post:
      tags: [Auth]
      summary: Login with email and password
      description: On success, sets an httpOnly refresh_token cookie. Response body contains only the access_token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string, format: password }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: login success
                data:
                  access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Invalid credentials
          content:
            application/json:
              example:
                status: error
                message: invalid credentials
                errors: {}
  /api/auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token using refresh token
      description: Reads the refresh token from an httpOnly cookie. For non-browser clients, you may also send it in the request body.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: token refreshed
                data:
                  access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Invalid or expired refresh token (session revoked)
          content:
            application/json:
              example:
                status: error
                message: invalid refresh token
                errors: {}
  /api/auth/me:
    get:
      tags: [Auth]
      summary: Get authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: profile retrieved
                data:
                  id: 1
                  name: "Admin"
                  email: "admin@example.com"
                  role: "admin"
                  avatar: null
                  created_at: "2024-11-01T10:00:00Z"
                  updated_at: "2024-11-01T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              example:
                status: error
                message: unauthorized
                errors: {}
  /api/auth/logout:
    post:
      tags: [Auth]
      summary: Logout and revoke refresh token
      description: Reads the refresh token from httpOnly cookie; for non-browser clients, you may also send it in the request body.
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: logged out
                data: null
        '401':
          description: Unauthorized
          content:
            application/json:
              example:
                status: error
                message: unauthorized
                errors: {}
  /api/dashboard:
    get:
      tags: [Dashboard]
      summary: Get dashboard data (role-based)
      description: Returns different dashboard data based on user role (admin or petugas)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    oneOf:
                      - $ref: '#/components/schemas/AdminDashboard'
                      - $ref: '#/components/schemas/PetugasDashboard'
        '401': { description: Unauthorized }
        '403': { description: Unauthorized role }
  /api/display/lokets:
    get:
      tags: [Display]
      summary: List lokets (public)
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: lokets retrieved
                data:
                  - id: 1
                    nama_loket: "Loket A"
                    kode_prefix: "A"
                    deskripsi: "Pendaftaran"
                    created_at: "2024-11-01T10:00:00Z"
                    updated_at: "2024-11-01T10:00:00Z"
  /api/display/lokets/{loket}:
    get:
      tags: [Display]
      summary: Get display data for a loket (public)
      parameters:
        - in: path
          name: loket
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: display retrieved
                data:
                  loket:
                    id: 1
                    nama_loket: "Loket A"
                    kode_prefix: "A"
                    deskripsi: "Pendaftaran"
                    created_at: "2024-11-01T10:00:00Z"
                    updated_at: "2024-11-01T10:00:00Z"
                  current:
                    id: 12
                    loket_id: 1
                    nomor_antrian: "A012"
                    status: "dipanggil"
                    waktu_panggil: "2024-11-01T10:45:00Z"
                    created_at: "2024-11-01T10:40:00Z"
                    updated_at: "2024-11-01T10:45:00Z"
                  next:
                    - id: 13
                      loket_id: 1
                      nomor_antrian: "A013"
                      status: "menunggu"
                      waktu_panggil: null
                      created_at: "2024-11-01T10:46:00Z"
                      updated_at: "2024-11-01T10:46:00Z"
        '404': { description: Not found }
  /api/display/overview:
    get:
      tags: [Display]
      summary: Display overview for all lokets (public)
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: overview retrieved
                data:
                  - loket:
                      id: 1
                      nama_loket: "Loket A"
                      kode_prefix: "A"
                      deskripsi: "Pendaftaran"
                    current:
                      id: 12
                      loket_id: 1
                      nomor_antrian: "A012"
                      status: "dipanggil"
                      waktu_panggil: "2024-11-01T10:45:00Z"
                      created_at: "2024-11-01T10:40:00Z"
                      updated_at: "2024-11-01T10:45:00Z"
                    next:
                      - id: 13
                        loket_id: 1
                        nomor_antrian: "A013"
                        status: "menunggu"
                        waktu_panggil: null
                        created_at: "2024-11-01T10:46:00Z"
                        updated_at: "2024-11-01T10:46:00Z"
  /api/display/antrians:
    post:
      tags: [Display]
      summary: Create an antrian (public)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AntrianCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              example:
                status: success
                message: antrian created
                data:
                  id: 20
                  loket_id: 1
                  nomor_antrian: "A020"
                  status: "menunggu"
                  waktu_panggil: null
                  created_at: "2024-11-01T11:10:00Z"
                  updated_at: "2024-11-01T11:10:00Z"
        '422':
          description: Validation error
          content:
            application/json:
              example:
                status: error
                message: validation error
                errors:
                  loket_id:
                    - The loket id field is required.
  /api/lokets:
    get:
      tags: [Lokets]
      summary: List lokets (paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 15 }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: order_by
          schema:
            type: string
            enum: [id, nama_loket, kode_prefix, created_at, updated_at]
        - in: query
          name: order_dir
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: lokets retrieved
                data:
                  data:
                    - id: 1
                      nama_loket: "Loket A"
                      kode_prefix: "A"
                      deskripsi: "Pendaftaran"
                      created_at: "2024-11-01T10:00:00Z"
                      updated_at: "2024-11-01T10:00:00Z"
                  pagination:
                    current_page: 1
                    per_page: 15
                    total: 2
                    last_page: 1
        '401': { description: Unauthorized }
    post:
      tags: [Lokets]
      summary: Create a loket
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoketCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              example:
                status: success
                message: loket created
                data:
                  id: 2
                  nama_loket: "Loket B"
                  kode_prefix: "B"
                  deskripsi: "Pembayaran"
                  created_at: "2024-11-01T11:00:00Z"
                  updated_at: "2024-11-01T11:00:00Z"
        '401': { description: Unauthorized }
  /api/lokets/{loket}:
    get:
      tags: [Lokets]
      summary: Get a loket by ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: loket
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: loket retrieved
                data:
                  id: 1
                  nama_loket: "Loket A"
                  kode_prefix: "A"
                  deskripsi: "Pendaftaran"
                  created_at: "2024-11-01T10:00:00Z"
                  updated_at: "2024-11-01T10:00:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
    put:
      tags: [Lokets]
      summary: Update a loket
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: loket
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoketUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: loket updated
                data:
                  id: 1
                  nama_loket: "Loket A1"
                  kode_prefix: "A"
                  deskripsi: "Pendaftaran"
                  created_at: "2024-11-01T10:00:00Z"
                  updated_at: "2024-11-01T12:00:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
    delete:
      tags: [Lokets]
      summary: Delete a loket
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: loket
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: loket deleted
                data: null
        '401': { description: Unauthorized }
        '404': { description: Not found }
  /api/users:
    get:
      tags: [Users]
      summary: List users (paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 15 }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: order_by
          schema:
            type: string
            enum: [id, name, email, role, created_at, updated_at]
        - in: query
          name: order_dir
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: users retrieved
                data:
                  data:
                    - id: 1
                      name: "Admin"
                      email: "admin@example.com"
                      role: "admin"
                      avatar: null
                      created_at: "2024-11-01T10:00:00Z"
                      updated_at: "2024-11-01T10:00:00Z"
                  pagination:
                    current_page: 1
                    per_page: 15
                    total: 1
                    last_page: 1
        '401': { description: Unauthorized }
    post:
      tags: [Users]
      summary: Create user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              example:
                status: success
                message: user created
                data:
                  id: 2
                  name: "User A"
                  email: "usera@example.com"
                  role: "petugas"
                  avatar: null
                  created_at: "2024-11-01T11:00:00Z"
                  updated_at: "2024-11-01T11:00:00Z"
        '401': { description: Unauthorized }
  /api/users/{user}:
    get:
      tags: [Users]
      summary: Get user by ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: user retrieved
                data:
                  id: 1
                  name: "Admin"
                  email: "admin@example.com"
                  role: "admin"
                  avatar: null
                  created_at: "2024-11-01T10:00:00Z"
                  updated_at: "2024-11-01T10:00:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
    put:
      tags: [Users]
      summary: Update user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: user updated
                data:
                  id: 1
                  name: "Admin A1"
                  email: "admin@example.com"
                  role: "admin"
                  avatar: null
                  created_at: "2024-11-01T10:00:00Z"
                  updated_at: "2024-11-01T12:00:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
    delete:
      tags: [Users]
      summary: Delete user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: user deleted
                data: null
        '401': { description: Unauthorized }
        '404': { description: Not found }
  /api/antrians:
    get:
      tags: [Antrians]
      summary: List antrians (paginated)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 15 }
        - in: query
          name: loket_id
          schema: { type: integer }
        - in: query
          name: status
          schema:
            type: string
            enum: [menunggu, dipanggil, selesai]
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: order_by
          schema:
            type: string
            enum: [id, loket_id, nomor_antrian, status, waktu_panggil, created_at, updated_at]
        - in: query
          name: order_dir
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: antrians retrieved
                data:
                  data:
                    - id: 10
                      loket_id: 1
                      nomor_antrian: "A010"
                      status: "menunggu"
                      waktu_panggil: null
                      created_at: "2024-11-01T10:30:00Z"
                      updated_at: "2024-11-01T10:30:00Z"
                  pagination:
                    current_page: 1
                    per_page: 15
                    total: 10
                    last_page: 1
        '401': { description: Unauthorized }
  /api/antrians/{antrian}:
    get:
      tags: [Antrians]
      summary: Get an antrian by ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: antrian
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: antrian retrieved
                data:
                  id: 10
                  loket_id: 1
                  nomor_antrian: "A010"
                  status: "menunggu"
                  waktu_panggil: null
                  created_at: "2024-11-01T10:30:00Z"
                  updated_at: "2024-11-01T10:30:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
    put:
      tags: [Antrians]
      summary: Update an antrian status
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: antrian
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AntrianUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              example:
                status: success
                message: antrian updated
                data:
                  id: 10
                  loket_id: 1
                  nomor_antrian: "A010"
                  status: "dipanggil"
                  waktu_panggil: "2024-11-01T10:45:00Z"
                  created_at: "2024-11-01T10:30:00Z"
                  updated_at: "2024-11-01T10:45:00Z"
        '401': { description: Unauthorized }
        '404': { description: Not found }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoketCreateRequest:
      type: object
      required: [nama_loket, kode_prefix]
      properties:
        nama_loket: { type: string, maxLength: 100 }
        kode_prefix: { type: string, maxLength: 5 }
        deskripsi: { type: string, nullable: true }
    LoketUpdateRequest:
      type: object
      properties:
        nama_loket: { type: string, maxLength: 100 }
        kode_prefix: { type: string, maxLength: 5 }
        deskripsi: { type: string, nullable: true }
    AntrianCreateRequest:
      type: object
      required: [loket_id]
      properties:
        loket_id: { type: integer }
    AntrianUpdateRequest:
      type: object
      required: [status]
      properties:
        status: { type: string, example: dipanggil }
    UserCreateRequest:
      type: object
      required: [name, email, password]
      properties:
        name: { type: string, maxLength: 255 }
        email: { type: string, format: email, maxLength: 255 }
        password: { type: string, minLength: 6 }
        role: { type: string, nullable: true, maxLength: 50 }
        avatar: { type: string, nullable: true, maxLength: 2048 }
        google_id: { type: string, nullable: true, maxLength: 255 }
    UserUpdateRequest:
      type: object
      properties:
        name: { type: string, maxLength: 255 }
        email: { type: string, format: email, maxLength: 255 }
        password: { type: string, minLength: 6 }
        role: { type: string, nullable: true, maxLength: 50 }
        avatar: { type: string, nullable: true, maxLength: 2048 }
        google_id: { type: string, nullable: true, maxLength: 255 }
    AdminDashboard:
      type: object
      properties:
        statistics:
          type: object
          properties:
            total_lokets: { type: integer }
            total_users: { type: integer }
            total_petugas: { type: integer }
            total_antrians_today: { type: integer }
        antrian_by_status:
          type: object
          properties:
            menunggu: { type: integer }
            dipanggil: { type: integer }
            selesai: { type: integer }
        loket_statistics:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              nama_loket: { type: string }
              kode_prefix: { type: string }
              total_today: { type: integer }
              menunggu: { type: integer }
              dipanggil: { type: integer }
              selesai: { type: integer }
        recent_antrians:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              loket_id: { type: integer }
              nomor_antrian: { type: string }
              status: { type: string, enum: [menunggu, dipanggil, selesai] }
              waktu_panggil: { type: string, format: date-time, nullable: true }
              created_at: { type: string, format: date-time }
              updated_at: { type: string, format: date-time }
              loket:
                type: object
                properties:
                  id: { type: integer }
                  nama_loket: { type: string }
                  kode_prefix: { type: string }
                  deskripsi: { type: string, nullable: true }
        hourly_statistics:
          type: array
          items:
            type: object
            properties:
              hour: { type: integer, description: "Hour of the day (0-23)" }
              total: { type: integer, description: "Total antrians in that hour" }
      example:
        statistics:
          total_lokets: 5
          total_users: 12
          total_petugas: 8
          total_antrians_today: 45
        antrian_by_status:
          menunggu: 12
          dipanggil: 3
          selesai: 30
        loket_statistics:
          - id: 1
            nama_loket: "Loket A"
            kode_prefix: "A"
            total_today: 15
            menunggu: 5
            dipanggil: 1
            selesai: 9
        recent_antrians:
          - id: 45
            loket_id: 1
            nomor_antrian: "A015"
            status: "menunggu"
            waktu_panggil: null
            created_at: "2024-11-01T14:30:00Z"
            updated_at: "2024-11-01T14:30:00Z"
            loket:
              id: 1
              nama_loket: "Loket A"
              kode_prefix: "A"
              deskripsi: "Pendaftaran"
        hourly_statistics:
          - hour: 8
            total: 5
          - hour: 9
            total: 12
          - hour: 10
            total: 15
    PetugasDashboard:
      type: object
      properties:
        statistics:
          type: object
          properties:
            total_antrians_today: { type: integer }
            menunggu: { type: integer }
            dipanggil: { type: integer }
            selesai: { type: integer }
        current_queue:
          type: object
          nullable: true
          properties:
            id: { type: integer }
            loket_id: { type: integer }
            nomor_antrian: { type: string }
            status: { type: string }
            waktu_panggil: { type: string, format: date-time }
            created_at: { type: string, format: date-time }
            loket:
              type: object
              properties:
                id: { type: integer }
                nama_loket: { type: string }
                kode_prefix: { type: string }
        next_queue:
          type: object
          nullable: true
          properties:
            id: { type: integer }
            loket_id: { type: integer }
            nomor_antrian: { type: string }
            status: { type: string }
            created_at: { type: string, format: date-time }
            loket:
              type: object
              properties:
                id: { type: integer }
                nama_loket: { type: string }
                kode_prefix: { type: string }
        recent_antrians:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              loket_id: { type: integer }
              nomor_antrian: { type: string }
              status: { type: string, enum: [menunggu, dipanggil, selesai] }
              waktu_panggil: { type: string, format: date-time, nullable: true }
              created_at: { type: string, format: date-time }
              loket:
                type: object
                properties:
                  id: { type: integer }
                  nama_loket: { type: string }
                  kode_prefix: { type: string }
        loket_statistics:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              nama_loket: { type: string }
              kode_prefix: { type: string }
              total_today: { type: integer }
              menunggu: { type: integer }
              dipanggil: { type: integer }
              selesai: { type: integer }
      example:
        statistics:
          total_antrians_today: 15
          menunggu: 5
          dipanggil: 1
          selesai: 9
        current_queue:
          id: 12
          loket_id: 1
          nomor_antrian: "A012"
          status: "dipanggil"
          waktu_panggil: "2024-11-01T14:20:00Z"
          created_at: "2024-11-01T14:15:00Z"
          loket:
            id: 1
            nama_loket: "Loket A"
            kode_prefix: "A"
        next_queue:
          id: 13
          loket_id: 1
          nomor_antrian: "A013"
          status: "menunggu"
          created_at: "2024-11-01T14:18:00Z"
          loket:
            id: 1
            nama_loket: "Loket A"
            kode_prefix: "A"
        recent_antrians:
          - id: 15
            loket_id: 1
            nomor_antrian: "A015"
            status: "menunggu"
            waktu_panggil: null
            created_at: "2024-11-01T14:30:00Z"
            loket:
              id: 1
              nama_loket: "Loket A"
              kode_prefix: "A"
        loket_statistics:
          - id: 1
            nama_loket: "Loket A"
            kode_prefix: "A"
            total_today: 15
            menunggu: 5
            dipanggil: 1
            selesai: 9
